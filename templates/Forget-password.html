<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizVerse | Forgot Password</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .right-alignment{
          text-align: right
        }
        .login-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .input-field:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }
        .btn-primary {
            background: linear-gradient(to right, #667eea, #764ba2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            transition: all 0.3s ease;
        }
        .step-circle.active {
            background: linear-gradient(to right, #667eea, #764ba2);
            border-color: transparent;
        }
        .step-circle.completed {
            background: #4CAF50;
            border-color: transparent;
        }
        .step-line {
            flex: 1;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            margin-top: 20px;
        }
        .otp-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .otp-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-weight: 600;
        }
        .otp-input:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            outline: none;
        }
        .password-strength {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }
        .strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
        }
        .message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: #c8e6c9;
        }
        .message.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #ffcdd2;
        }
        .message.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.3);
            color: #bbdefb;
        }
        .step {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .step.active {
            display: block;
        }
        .loader {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="login-card rounded-2xl shadow-2xl overflow-hidden w-full max-w-md" data-aos="fade-up">
        <div class="p-8 sm:p-10">
            <div class="text-center mb-8">
                <div class="flex justify-center mb-4">
                    <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center">
                        <i data-feather="key" class="text-white w-8 h-8"></i>
                    </div>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Reset Your Password</h1>
                <p class="text-white/80">Follow the steps to regain access to your account</p>
            </div>

            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step-circle active" id="step1Circle">1</div>
                <div class="step-line"></div>
                <div class="step-circle" id="step2Circle">2</div>
                <div class="step-line"></div>
                <div class="step-circle" id="step3Circle">3</div>
            </div>

            <!-- Message Container -->
            <div class="message" id="message"></div>

            <!-- Step 1: Enter Email -->
            <div class="step active" id="step1">
                <div class="mb-6">
                    <label for="email" class="block text-sm font-medium text-white mb-2">Email Address</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-feather="mail" class="text-white/60"></i>
                        </div>
                        <input type="email" id="email" autocomplete="email" required 
                            class="input-field pl-10 w-full px-4 py-3 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/30"
                            placeholder="Enter your registered email">
                    </div>
                    <p class="mt-2 text-sm text-white/60">
                        We'll send a verification code to this email
                    </p>
                </div>

                <div class="flex gap-3">
                    <button type="button" onclick="sendVerificationCode()"
                            class="btn-primary flex-1 flex justify-center py-3 px-4 rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white/50 transition-all duration-300">
                        Send Code
                    </button>
                    <button type="button" onclick="goToLogin()"
                            class="btn-secondary flex-1 flex justify-center py-3 px-4 rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white/50 transition-all duration-300">
                        Back to Login
                    </button>
                </div>
            </div>

            <!-- Step 2: Verify OTP -->
            <div class="step" id="step2">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-white mb-2">Verification Code</label>
                    <p class="text-sm text-white/60 mb-4" id="emailDisplay"></p>
                    
                    <div class="otp-inputs">
                        <input type="text" maxlength="1" class="otp-input" oninput="moveToNext(this, 1)">
                        <input type="text" maxlength="1" class="otp-input" oninput="moveToNext(this, 2)">
                        <input type="text" maxlength="1" class="otp-input" oninput="moveToNext(this, 3)">
                        <input type="text" maxlength="1" class="otp-input" oninput="moveToNext(this, 4)">
                        <input type="text" maxlength="1" class="otp-input" oninput="moveToNext(this, 5)">
                        <input type="text" maxlength="1" class="otp-input" oninput="moveToNext(this, 6)">
                    </div>
                    
                    <p class="mt-4 text-sm text-white/60 text-center">
                        Didn't receive code? 
                        <button type="button" onclick="resendCode()" class="text-white hover:text-white/80 font-medium">
                            Resend
                        </button>
                    </p>
                </div>

                <div class="flex gap-3">
                    <button type="button" onclick="verifyCode()"
                            class="btn-primary flex-1 flex justify-center py-3 px-4 rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white/50 transition-all duration-300">
                        Verify Code
                    </button>
                    <button type="button" onclick="goToStep(1)"
                            class="btn-secondary flex-1 flex justify-center py-3 px-4 rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white/50 transition-all duration-300">
                        Change Email
                    </button>
                </div>
            </div>

            <!-- Step 3: New Password -->
            <div class="step" id="step3">
                <div class="space-y-6">
                    <div>
                        <label for="newPassword" class="block text-sm font-medium text-white mb-2">New Password</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i data-feather="lock" class="text-white/60"></i>
                            </div>
                            <input type="password" id="newPassword" required 
                                class="input-field pl-10 w-full px-4 py-3 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/30"
                                placeholder="Enter new password"
                                oninput="checkPasswordStrength()">
                        </div>
                        <div class="password-strength">
                            <div class="strength-bar" id="strengthBar"></div>
                        </div>
                        <p class="mt-2 text-sm text-white/60">
                            Must be at least 8 characters with letters and numbers
                        </p>
                    </div>

                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium text-white mb-2">Confirm Password</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i data-feather="lock" class="text-white/60"></i>
                            </div>
                            <input type="password" id="confirmPassword" required 
                                class="input-field pl-10 w-full px-4 py-3 rounded-lg text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/30"
                                placeholder="Confirm new password">
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button type="button" onclick="resetPassword()"
                                class="btn-primary flex-1 flex justify-center py-3 px-4 rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white/50 transition-all duration-300">
                            Reset Password
                        </button>
                        <button type="button" onclick="goToStep(2)"
                                class="btn-secondary flex-1 flex justify-center py-3 px-4 rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white/50 transition-all duration-300">
                            Back
                        </button>
                    </div>
                </div>
            </div>

            <!-- Success Step -->
            <div class="step" id="step4">
                <div class="text-center py-8">
                    <div class="w-20 h-20 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-6">
                        <i data-feather="check" class="text-green-400 w-10 h-10"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-3">Password Reset Successful!</h2>
                    <p class="text-white/80 mb-8">
                        Your password has been successfully reset. You can now log in with your new password.
                    </p>
                    <button type="button" onclick="goToLogin()"
                            class="btn-primary w-full flex justify-center py-3 px-4 rounded-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white/50 transition-all duration-300">
                        Go to Login
                    </button>
                </div>
            </div>

            <!-- Loader -->
            <div class="loader" id="loader">
                <div class="spinner"></div>
                <p class="mt-3 text-white/80">Processing...</p>
            </div>

            <!-- Back to Login -->
            <div class="mt-6 text-center">
                <p class="text-sm text-white/80">
                    Remember your password? 
                    <a href="index.html" class="font-medium text-white hover:text-white/80 transition">Sign in</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Initialize animations
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });
        feather.replace();

        // State variables
        let currentStep = 1;
        let generatedOTP = '';
        let userEmail = '';
        let resetToken = '';

        // Show message function
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }

        // Show/hide loader
        function showLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
        }

        // Navigate between steps
        function goToStep(step) {
            // Hide all steps
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            
            // Show target step
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            
            // Update step indicators
            updateStepIndicators(step);
            
            // Reset feather icons for new elements
            feather.replace();
        }

        function updateStepIndicators(activeStep) {
            const circles = document.querySelectorAll('.step-circle');
            circles.forEach((circle, index) => {
                const stepNum = index + 1;
                circle.classList.remove('active', 'completed');
                
                if (stepNum < activeStep) {
                    circle.classList.add('completed');
                } else if (stepNum === activeStep) {
                    circle.classList.add('active');
                }
                
                if (stepNum === activeStep) {
                    circle.innerHTML = stepNum;
                } else if (stepNum < activeStep) {
                    circle.innerHTML = '<i data-feather="check"></i>';
                } else {
                    circle.innerHTML = stepNum;
                }
            });
            
            feather.replace();
        }

        // Validate email format
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Send verification code
        function sendVerificationCode() {
            const email = document.getElementById('email').value.trim();
            
            if (!email) {
                showMessage('Please enter your email address', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showMessage('Please enter a valid email address', 'error');
                return;
            }
            
            userEmail = email;
            showLoader(true);
            
            // Simulate API call (replace with actual backend call)
            setTimeout(() => {
                showLoader(false);
                
                // Generate OTP for demo
                generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
                
                // Show email in next step
                document.getElementById('emailDisplay').textContent = `Code sent to ${email}`;
                
                // In production, send OTP via email
                console.log(`OTP for ${email}: ${generatedOTP}`);
                
                showMessage(`Verification code sent to ${email}`, 'success');
                goToStep(2);
                
                // Auto-fill OTP for demo (remove in production)
                setTimeout(() => {
                    const inputs = document.querySelectorAll('.otp-input');
                    for (let i = 0; i < generatedOTP.length; i++) {
                        inputs[i].value = generatedOTP[i];
                    }
                }, 500);
            }, 1500);
        }

        // OTP navigation
        function moveToNext(input, nextIndex) {
            const value = input.value;
            
            // Auto move to next input
            if (value.length === 1 && nextIndex <= 6) {
                const nextInput = document.querySelector(`.otp-input:nth-child(${nextIndex})`);
                if (nextInput) nextInput.focus();
            }
            
            // Move back on backspace
            if (value.length === 0 && nextIndex > 1) {
                const prevInput = document.querySelector(`.otp-input:nth-child(${nextIndex - 1})`);
                if (prevInput) prevInput.focus();
            }
        }

        // Verify OTP
        function verifyCode() {
            const inputs = document.querySelectorAll('.otp-input');
            let enteredOTP = '';
            inputs.forEach(input => enteredOTP += input.value);
            
            if (enteredOTP.length !== 6) {
                showMessage('Please enter the complete 6-digit code', 'error');
                return;
            }
            
            showLoader(true);
            
            // Simulate verification
            setTimeout(() => {
                showLoader(false);
                
                if (enteredOTP === generatedOTP) {
                    showMessage('Code verified successfully!', 'success');
                    
                    // Generate a mock reset token (in production, this comes from backend)
                    resetToken = 'reset_' + Math.random().toString(36).substr(2, 9);
                    
                    setTimeout(() => goToStep(3), 1000);
                } else {
                    showMessage('Invalid verification code. Please try again.', 'error');
                }
            }, 1000);
        }

        // Resend code
        function resendCode() {
            if (!userEmail) return;
            
            showLoader(true);
            
            setTimeout(() => {
                showLoader(false);
                
                // Generate new OTP
                generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
                console.log(`New OTP for ${userEmail}: ${generatedOTP}`);
                
                // Clear OTP inputs
                document.querySelectorAll('.otp-input').forEach(input => input.value = '');
                
                // Focus first input
                document.querySelector('.otp-input').focus();
                
                showMessage('New verification code sent to your email', 'success');
            }, 1500);
        }

        // Check password strength
        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthBar = document.getElementById('strengthBar');
            
            let strength = 0;
            let color = '#f44336';
            
            // Length check
            if (password.length >= 8) strength += 25;
            
            // Complexity checks
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[a-z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            
            // Set color based on strength
            if (strength >= 75) color = '#4CAF50';
            else if (strength >= 50) color = '#FF9800';
            else if (strength >= 25) color = '#FF5722';
            
            strengthBar.style.width = strength + '%';
            strengthBar.style.backgroundColor = color;
        }

        // Validate password
        function isStrongPassword(password) {
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasNumbers = /\d/.test(password);
            const hasMinimumLength = password.length >= 8;
            
            return hasUpperCase && hasLowerCase && hasNumbers && hasMinimumLength;
        }

        // Reset password
        function resetPassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!newPassword || !confirmPassword) {
                showMessage('Please fill in all password fields', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }
            
            if (!isStrongPassword(newPassword)) {
                showMessage('Password must be at least 8 characters with uppercase, lowercase letters and numbers', 'error');
                return;
            }
            
            showLoader(true);
            
            // Simulate API call to reset password
            setTimeout(() => {
                showLoader(false);
                
                // In production, send to backend:
                // fetch('/reset-password', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({
                //         token: resetToken,
                //         email: userEmail,
                //         newPassword: newPassword
                //     })
                // })
                
                showMessage('Password reset successful!', 'success');
                setTimeout(() => goToStep(4), 1000);
            }, 1500);
        }

        // Navigate to login
        function goToLogin() {
            window.location.href = 'index.html';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Focus email input
            document.getElementById('email').focus();
            
            // Enter key support for email step
            document.getElementById('email').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendVerificationCode();
                }
            });
            
            // Enter key support for password step
            document.getElementById('newPassword')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('confirmPassword').focus();
                }
            });
            
            document.getElementById('confirmPassword')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    resetPassword();
                }
            });
        });
    </script>
</body>
</html>